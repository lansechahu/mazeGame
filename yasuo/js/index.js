function userSign(e){var t=e;$.ajax({url:"/wx-help/generates-authorize-url",type:"POST",data:{url:t},success:function(e){console.log(e),window.location.href=e}})}function getOpenID(e,t,n){$.ajax({url:"/wx-help/get-user-info",type:"POST",data:{code:e},success:function(e){"error"==(e=JSON.parse(e)).status?userSign(t):n&&n(e)}})}$.ajax({url:"/wx-help/get-wx-config",type:"POST",dataType:"json",success:function(e){configWxShare(e)}});var shareObj={sharePath:"",shareImg:"",shareTitle:"",shareDesc:""};function configWxShare(e){wx.config({debug:!1,appId:e.appid,timestamp:e.timestamp,nonceStr:e.nonceStr,signature:e.signature,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo"]}),wx.ready(function(){setShare()})}function setShare(){wx.onMenuShareTimeline({title:shareObj.shareTitle,link:shareObj.sharePath,imgUrl:shareObj.shareImg,success:function(){},cancel:function(){}}),wx.onMenuShareAppMessage({title:shareObj.shareTitle,desc:shareObj.shareDesc,link:shareObj.sharePath,imgUrl:shareObj.shareImg,type:"link",dataUrl:"",success:function(){},cancel:function(){}})}function Loading(e,t){PIXI.Sprite.call(this,e,t);var n=this;function a(){n.loadEnd=!0}n.easing=t.easing||1,n.currpg=0,n.realpg=0,n.loadEnd=!1,n.progress=t.progress,n.complete=t.complete,n.loadFileArr=t.loadFileArr,this.start=function(){n.loader=new PIXI.loaders.Loader;for(var e=0;e<n.loadFileArr.length;e++)n.loader.add(n.loadFileArr[e]);n.loader.once("complete",a),n.loader.load()},this.update=function(){1==n.loadEnd&&(n.realpg=100,95<=n.currpg&&(n.currpg=100,n.complete&&n.complete())),n.realpg=n.loader.progress,n.currpg+=(n.realpg-n.currpg)*n.easing,n.progress&&n.progress(Math.floor(n.currpg))}}function CSprite(e,t,n,a,i){var o,r=n||0,l=a||0,s=i||!1;switch("fromImage"==t?o=new PIXI.Sprite.fromImage(e):"fromFrame"==t&&(o=new PIXI.Sprite.fromFrame(e)),n){case"left":r=0;break;case"center":r=.5;break;case"right":r=1}switch(a){case"top":l=0;break;case"center":l=.5;break;case"bottom":l=1}return o.anchor.set(r,l),o.interactive=s,o}function CdrawRect(e,t,n){var a={lineWeight:n.lineWeight||0,lineColor:n.lineColor||"0xffffff",lineAlpha:n.lineAlpha||0,fillColor:n.fillColor||"0xffffff",fillAlpha:n.fillAlpha||1,interactive:n.interacitve||!1},i=new PIXI.Graphics;return i.lineStyle(a.lineWeight,a.lineColor,a.lineAlpha),i.beginFill(a.fillColor,a.fillAlpha),i.drawRect(0,0,e,t),i.interactive=a.interactive,i}function CdrawCircle(e,t){var n={lineWeight:t.lineWeight||0,lineColor:t.lineColor||"0xffffff",lineAlpha:t.lineAlpha||0,fillColor:t.fillColor||"0xffffff",fillAlpha:t.fillAlpha||1,interactive:t.interacitve||!1},a=new PIXI.Graphics;return a.lineStyle(n.lineWeight,n.lineColor,n.lineAlpha),a.beginFill(n.fillColor,n.fillAlpha),a.drawCircle(0,0,e),a.interactive=n.interactive,a}function CBtnText(e,t,n,a){var i={lineWeight:a.lineWeight||0,lineColor:a.lineColor||"0xffffff",lineAlpha:a.lineAlpha||0,fillColor:a.fillColor||"0xffffff",fillAlpha:a.fillAlpha||1,fontSize:a.fontSize||24,fontColor:a.fontColor||"0x000000",align:a.align||"left"},o=new PIXI.Graphics;o.lineStyle(i.lineWeight,i.lineColor,i.lineAlpha),o.beginFill(i.fillColor,i.fillAlpha),o.drawRect(0,0,t,n),o.interactive=!0;var r=new PIXI.TextStyle({fontSize:36,fill:i.fontColor,align:i.align}),l=new PIXI.Text(e,r);return o.addChild(l),l.x=o.width/2-l.width/2,l.y=o.height/2-l.height/2,o}function setVideo(e,t,n,a,i,o,r){var l,s=[];null==r&&(r=!1),null==i&&(i=.5);for(var c=n;c<=a;c++){var p=PIXI.Texture.fromFrame(e+c+t);s.push(p)}return(l=new PIXI.extras.AnimatedSprite(s)).animationSpeed=i,l.loop=r,null!=o&&(l.onComplete=o),l}function VideoStop(e,t,n,a){a?e.gotoAndStop(Math.floor(n%14)):t<=n?e.gotoAndStop(t):n<0?e.gotoAndStop(0):e.gotoAndStop(n)}Loading.constructor=Loading,Loading.prototype=Object.create(PIXI.Sprite.prototype);var fl=50,vpX=0,vpY=0;function onPerspective(e){var t=fl/(fl+e.zpos);e.scale.x=e.scale.y=t,e.x=vpX+e.xpos*t,e.y=vpY+e.ypos*t}function setSpriteMc(e,t,n){var a=new PIXI.Sprite;return a.position.set(t,n),a.scale.set(1),e.addChild(a),a}function Particles(){THREE.Object3D.call(this),this.myType="particle";var s,c,p,d=this;function h(){return 0==Math.floor(2*Math.random())?-1:1}this.init=function(){p=new Array,s=THREE.ImageUtils.loadTexture("model/particle1.png"),d.join()},this.join=function(){(c=new THREE.ParticleSystem).sortParticles=!0;for(var e=0;e<1e3;e++){var t=new THREE.Geometry,n=new THREE.ParticleBasicMaterial({size:4,transparent:!0,opacity:1,map:s,depthWrite:!1,sizeAttenuation:!0}),a=20*Math.random()-10,i=1*Math.random(),o=10-20*Math.random(),r=new THREE.Vector3(a,i,o);r.angle=Math.floor(360*Math.random()),r.angleSpeed=.005,r.radius=30*Math.random()+5,r.z_radius=20*Math.random()+10,r.__x_dir=h(),r.__y_dir=h(),r.__z_dir=h(),r.initX=a,r.initY=i,r.initZ=o,r.x=r.__x_dir*Math.cos(r.angle)*r.radius+r.initX,r.y=r.__y_dir*Math.sin(r.angle)*r.radius+r.initY,r.z=r.__z_dir*Math.sin(r.angle)*r.z_radius+r.initZ,n.opacity=Math.sin(r.angle),n.needsUpdate=!0,t.vertices.push(r);var l=new THREE.Points(t,n);c.add(l),p.push(l)}d.add(c)},this.aa=function(){c.geometry.vertices.forEach(function(e){e.x=0,e.y=0,e.z=0}),geom.verticesNeedUpdate=!0},this.update=function(){for(var e=0;e<p.length;e++){var t=p[e],n=t.geometry.vertices[0];n.angle+=n.angleSpeed,n.x=n.__x_dir*Math.cos(n.angle)*n.radius+n.initX,n.y=n.__y_dir*Math.sin(n.angle)*n.radius+n.initY,n.z=n.__z_dir*Math.sin(n.angle)*n.z_radius+n.initZ,t.material.opacity=Math.sin(n.angle),t.geometry.verticesNeedUpdate=!0}}}function Key(){THREE.Object3D.call(this),this.myType="key",this.myId=0,this.keyOut=!1;var n,a,i=this,t=0,o=1,r=!1;this.init=function(){var e=new THREE.MTLLoader;e.setPath("model/key/"),e.load("key.mtl",function(e){e.preload();var t=new THREE.OBJLoader;t.setMaterials(e),t.setPath("model/key/"),t.load("key.obj",function(e){(n=e).scale.multiplyScalar(.1),n.myType="key",i.add(n),n.castShadow=!0,a=new THREE.SpotLight("0xffffff"),i.add(a),a.target=n,a.position.x=n.position.x,a.position.y=3,a.position.z=n.position.z,a.distance=5,a.angle=.1*Math.PI,a.castShadow=!0})})},this.out=function(){r=!0,setTimeout(function(){i.remove(n),i.keyOut=!0},1e3)},this.update=function(e){n&&(r&&(20<=(o+=1)&&(o=20),e(),0<=a.angle?a.angle-=.001*Math.PI:delKey()),t+=o,n.rotation.y=t*Math.PI/180)}}Particles.constructor=Particles,Particles.prototype=Object.create(THREE.Object3D.prototype),Key.constructor=Key,Key.prototype=Object.create(THREE.Object3D.prototype);var mazeArr=[],cubeWid=6,cubeHei=8,cubeDep=6,sPoint=null,ePoint=null,mazeW=9,mazeH=9,door;function createCube(e){var t,n,a=e||"wall";"wall"==a?(n=cubeHei,(t=THREE.ImageUtils.loadTexture("model/guWall.jpg")).wrapS=THREE.RepeatWrapping,t.wrapT=THREE.RepeatWrapping,t.repeat.set(2.5,2.5),t.needsUpdate=!0):"door"==a&&(n=cubeHei,(t=THREE.ImageUtils.loadTexture("model/endWall.jpg")).needsUpdate=!0);var i=new THREE.MeshPhongMaterial({map:t}),o=new THREE.CubeGeometry(cubeWid,n,cubeDep,5,5,5);return new THREE.Mesh(o,i)}var roadArr=[],mixer;function createMaze(){for(var a=mazeW,b=mazeH,roomIndexs=new Array,arr=new Array,i=0;i<a;i++){arr[i]=new Array;for(var j=0;j<b;j++)i%2&&j%2?(arr[i][j]=2,roomIndexs.push({x:j,y:i})):arr[i][j]=0}for(var s={x:roomIndexs[0].x,y:roomIndexs[0].y},e={x:roomIndexs[roomIndexs.length-1].x,y:roomIndexs[roomIndexs.length-1].y},c=roomIndexs[0],backs=new Array;1!=arr[e.y][e.x]||roomIndexs.length;){arr[c.y][c.x]=1;var direct=new Array;0<c.y-2&&1!=arr[c.y-2][c.x]&&direct.push("up"),c.x+2<b&&1!=arr[c.y][c.x+2]&&direct.push("right"),c.y+2<a&&1!=arr[c.y+2][c.x]&&direct.push("down"),0<c.x-2&&1!=arr[c.y][c.x-2]&&direct.push("left");var currentDirect=direct[Math.floor(Math.random()*direct.length)];switch(roomIndexs.forEach(function(e){e.x==c.x&&e.y==c.y&&roomIndexs.splice(roomIndexs.indexOf(e),1)}),currentDirect){case"up":arr[c.y-1][c.x]=1,c.y-=2,backs.push({x:c.x,y:c.y});break;case"right":arr[c.y][c.x+1]=1,c.x+=2,backs.push({x:c.x,y:c.y});break;case"down":arr[c.y+1][c.x]=1,c.y+=2,backs.push({x:c.x,y:c.y});break;case"left":arr[c.y][c.x-1]=1,c.x-=2,backs.push({x:c.x,y:c.y});break;default:var rnd=Math.floor(Math.random()*backs.length);c=backs[rnd],backs.splice(rnd,1)}}var allSe=new Array(0,1,2,3),seArr0=new Array,seArr1=new Array,seArr2=new Array,seArr3=new Array;for(i=0;i<arr.length;i++){var temp=arr[i];for(j=0;j<temp.length;j++)0==j&&1==temp[j+1]&&seArr0.push({x:j,y:i}),j==temp.length-1&&1==temp[j-1]&&seArr1.push({x:j,y:i}),0==i&&1==arr[i+1][j]&&seArr2.push({x:j,y:i}),i==arr.length-1&&1==arr[i-1][j]&&seArr3.push({x:j,y:i})}var m=Math.floor(Math.random()*allSe.length),n=allSe[m];allSe.splice(m,1);var sn=Math.floor(Math.random()*eval("seArr"+n).length);sPoint=eval("seArr"+n)[sn],arr[sPoint.y][sPoint.x]=0,m=Math.floor(Math.random()*allSe.length),n=allSe[m],allSe.splice(m,1);var en=Math.floor(Math.random()*eval("seArr"+n).length);ePoint=eval("seArr"+n)[en],arr[ePoint.y][ePoint.x]=6,console.log(arr);for(var wallArr=[],centerX=arr[0].length*cubeWid/2,centerZ=arr.length/2*cubeDep,i=0;i<arr.length;i++)for(var j=0;j<arr[i].length;j++)if(0==arr[i][j]){var temp=createCube();temp.position.x=cubeWid*j-centerX,temp.position.y=cubeHei/3,temp.position.z=cubeDep*i-centerZ,wallArr.push(temp)}else if(6==arr[i][j])door=createCube("door"),door.myType="door",console.log(j,i),door.position.x=cubeWid*j-centerX,door.position.y=cubeHei/3,door.position.z=cubeDep*i-centerZ,0==j?door.near={x:door.position.x-cubeWid,z:door.position.z}:j==arr[i].length-1?door.near={x:door.position.x+cubeWid,z:door.position.z}:0==i?door.near={x:door.position.x,z:door.position.z-cubeDep}:i==arr.length-1&&(door.near={x:door.position.x,z:door.position.z+cubeDep}),wallArr.push(door);else if(1==arr[i][j]){var obj={x:0,z:0};obj.x=cubeWid*j-centerX,obj.z=cubeDep*i-centerZ,roadArr.push(obj)}return wallArr}function doorOut(){TweenMax.to(door.position,1,{y:-5})}function ThreeArea(){var i,o,r,s,l,c,p,d,h,u,a,m,f=[],g=[],x=!1,y=[],w=new THREE.Vector3,E=new THREE.Raycaster,v=!0,T=!0;function b(e){var t=(new THREE.TextureLoader).load("model/end.jpg");t.wrapT=THREE.RepeatWrapping,t.anisotropy=4;var n=new THREE.MeshPhongMaterial({map:t}),a=new THREE.CubeGeometry(8,6,8),i=new THREE.Mesh(a,n);s.add(i),i.position.x=e.x,i.position.z=e.z,i.position.y=3}var M=[0,0,0,0];function t(e){h.rotation.y=p.cameraBox.rotation.y,function(){for(var e=0;e<g.length;e++){var t=g[e];t.rotation.y=p.cameraBox.rotation.y;var n=h.geometry.vertices[t.pointIndex].clone().applyMatrix4(h.matrix);t.position.x=n.x+0,t.position.y=-.5+n.y,t.position.z=n.z+0}}(),function(e){for(var t=0;t<g.length;t++){var n=g[t];M[t]=0;for(var a=n.position.clone(),i=0;i<n.geometry.vertices.length;i++){var o=n.geometry.vertices[i].clone().applyMatrix4(n.matrix).sub(n.position),r=new THREE.Raycaster(a,o.clone().normalize()).intersectObjects(e);if(0<r.length&&r[0].distance<o.length()){M[t]=1;break}}}1==M[0]&&(1==M[1]?v=!1:1==M[2]?!1:v=!1),1==M[1]&&(1==M[0]?v=!1:1==M[3]?!1:v=!1),1==M[2]&&(1==M[3]?T=!1:1==M[0]?!1:T=!1),1==M[3]&&(1==M[2]?T=!1:1==M[1]||(T=!1)),0==M[0]&&0==M[1]&&(v=!0),0==M[2]&&0==M[3]&&(T=!0),0==M[0]&&0==M[2]&&!0,0==M[1]&&0==M[3]&&!0}(e)}function e(e){if(gameBegin){e.preventDefault(),a=event.targetTouches[0].pageX,m=event.targetTouches[0].pageY,w.x=a/r.domElement.clientWidth*2-1,w.y=-m/r.domElement.clientHeight*2+1,E.setFromCamera(w,l);var t=E.intersectObjects(y,!0);if(0<t.length){var n=t[0].object;"key"==n.parent.myType&&(console.log("点击了钥匙"),x||(gameBegin=!1,x=!0,u.out(),function(){j=THREE.ImageUtils.loadTexture("model/particle2.png"),(I=new THREE.ParticleSystem).sortParticles=!0;for(var e=0;e<100;e++){var t=new THREE.Geometry,n=new THREE.ParticleBasicMaterial({size:.3,transparent:!0,opacity:1,map:j,depthWrite:!1,sizeAttenuation:!0}),a=u.position.x,i=u.position.y+1*Math.random(),o=u.position.z,r=new THREE.Vector3(a,i,o);t.vertices.push(r),r.initX=a,r.initZ=o;var l=new THREE.Points(t,n);l.speedX=R(-.3,.3),l.speedZ=R(-.3,.3),I.add(l),S.push(l)}s.add(I)}())),"door"==n.myType&&(console.log("点击了门"),x&&doorOut())}}}var I,j,S=[];function n(){for(var e=S.length-1;0<=e;e--){var t=S[e],n=t.geometry.vertices[0];n.x+=t.speedX,n.z+=t.speedZ,1<=Math.abs(n.x-n.initX)&&(u.keyOut?I.remove(t):(t.speedX=R(-.3,.3),t.speedZ=R(-.3,.3),n.x=u.position.x,n.y=u.position.y+1*Math.random(),n.z=u.position.z,n.initX=n.x,n.initZ=n.z)),t.geometry.verticesNeedUpdate=!0}}function R(e,t){for(var n=e+Math.random()*(t-e);0==n;)n=e+Math.random()*(t-e);return n}this.init=function(e,t){var n,a;i=e,o=t,(r=new THREE.WebGLRenderer({antialias:!0,alpha:!0,preserveDrawingBuffer:!0})).setSize(i,o),r.shadowMapEnabled=!0,document.getElementById("canvas-frame").appendChild(r.domElement),r.setClearColor(6710886,1),(s=new THREE.Scene).fog=new THREE.FogExp2(6710886,.1),l=new THREE.PerspectiveCamera(45,i/o,.1,2e4),(p=new Controls(l,s)).init(),p.setPosition({x:0,y:0,z:50}),c=new THREE.AmbientLight(6710886),s.add(c),n=new THREE.RenderPass(s,l),(a=new THREE.FilmPass(.3,.3,2048,!1)).renderToScreen=!0,new THREE.GlitchPass(16).renderToScreen=!0,(d=new THREE.EffectComposer(r)).addPass(n),d.addPass(a)},this.create_floor=function(){var e=new THREE.PlaneGeometry(500,500),t=new THREE.MeshPhongMaterial({map:THREE.ImageUtils.loadTexture("model/wall.jpg")}),n=new THREE.Mesh(e,t);n.material.map.wrapS=THREE.RepeatWrapping,n.material.map.wrapT=THREE.RepeatWrapping,n.material.map.repeat.set(26,26),n.material.map.needsUpdate=!0,s.add(n),n.receiveShadow=!0,n.rotation.x=-90*Math.PI/180},this.create_Maze=function(){f=createMaze();for(var e=0;e<f.length;e++){var t=f[e];s.add(t),"door"==t.myType&&(y.push(t),b(t.near))}var n=Math.floor(Math.random()*roadArr.length),a=roadArr[n];p.begin(a.x,a.z),function(){(u=new Key).init(),s.add(u),y.push(u);var e=Math.floor(Math.random()*roadArr.length),t=roadArr[e];u.position.x=t.x,u.position.y=1,u.position.z=t.z}()},this.changeCamera=function(){p.changeCamera()},this.controlState=function(e){p.enabled=e},this.initHitBall=function(){var e,t,n,a=[4,1,5,0],i=new THREE.CubeGeometry(.5,2,.5),o=new THREE.MeshBasicMaterial({color:16711680,transparent:!0,opacity:.2});h=new THREE.Mesh(i,o),s.add(h),h.position.x=p.cameraBox.position.x,h.position.y=1.2,h.position.z=p.cameraBox.position.z;for(var r=0;r<4;r++){var l=(e=r,void 0,t=new THREE.SphereGeometry(.25,3,2),n=new THREE.MeshBasicMaterial({color:[16773120,4095,3840,255][e],transparent:!0,opacity:.5,wireframe:!0}),new THREE.Mesh(t,n));s.add(l),l.pointIndex=a[r],g.push(l)}},this.setCameraBox=function(e,t){p.rotationY(e),(t<0&&1==v||0<t&&1==T)&&p.cameraBox.translateZ(t)},this.initAction=function(){$("body").on("touchstart",e)},this.delKey=function(){s.remove(u),u=null,s.remove(I)},this.update=function(e){h&&(h.position.x=p.cameraBox.position.x,h.position.y=1.2,h.position.z=p.cameraBox.position.z,t(f)),p&&p.update(e),u&&u.update(n),d?d.render(e):r.render(s,l)}}function PixiArea(){var n,a,i,o,r,t,l,e,s,c,p;this.name="PixiArea",this.init=function(e,t){n=e,a=t,i=new PIXI.Application(640,640/(n/a),{backgroundColor:0,transparent:!0}),document.getElementById("pixiStage").appendChild(i.view),o=i.stage,r=new PIXI.Container,o.addChild(r)},this.createLoading=function(e){var t=[];t.push("images/key1.png"),t.push("images/key2.png"),t.push("model/end.jpg"),t.push("model/endWall.jpg"),t.push("model/guWall.jpg"),t.push("model/particle2.png"),t.push("model/wall.jpg"),t.push("model/key/key.obj"),(c=new Loading(null,{loadFileArr:[t],progress:function(e){console.log(e)},complete:function(){console.log("加载完成"),c=null,e&&e()},easing:1})).start()},this.createRocker=function(e){t=new Rocker,r.addChild(t),t.init(e),t.x=.8*i.view.width-0,t.y=.9*i.view.height-0},this.tipIn=function(){p=CBtnText("在迷宫中找到钥匙打开大门\n(点击关闭)",500,200,{fillColor:"0xffffff",fontSize:16,fontColor:"0x000000",align:"center"}),o.addChild(p),p.x=70,p.y=window.innerHeight/2,p.alpha=0,TweenMax.to(p,.5,{alpha:1}),p.on("pointerdown",function(){o.removeChild(p),gameBegin=!0})},this.btnIn=function(e){l=CBtnText("改变视角",150,50,{fillColor:"0xffffff",fontSize:16,fontColor:"0x000000"}),o.addChild(l),l.on("pointerdown",function(){e()})},this.keysIcon=function(){e=new PIXI.Sprite.fromImage("images/key1.png"),r.addChild(e),e.x=200,e.y=10,s=new PIXI.Sprite.fromImage("images/key2.png"),r.addChild(s),s.x=200,s.y=10,s.alpha=0},this.keysChange=function(){s.alpha=1,e.alpha=0},this.update=function(e){c&&c.update(),t&&t.update(e)}}function createMan(a){var i=(new THREE.TextureLoader).load("model/color.jpg");(new THREE.JSONLoader).load("model/person.json",function(e,t){var n=new THREE.MeshPhongMaterial({map:i,flatShading:!0,morphTargets:!0,morphNormals:!0,specular:0,shininess:0,skinning:!0});mesh=new THREE.SkinnedMesh(e,n),mesh.scale.set(.5,.5,.5),(mixer=new THREE.AnimationMixer(mesh)).clipAction(e.animations[0]).play(),a(mesh)})}function manUpdate(){mixer&&mixer.update(delta)}var Controls=function(e,t){this.speed=1,this.enabled=!0,this.panY=0,this.cameraBox=null;var n=this,a=e,i=t,o=0,r=window.innerWidth/2,l=window.innerHeight/2,s=0,c=0,p=0,d=0,h=0,u=0,m=0,f=0,g=!1;function x(e){e.preventDefault(),n.enabled&&0!=gameBegin&&(p=e.touches[0].pageX-r,m=h,d=e.touches[0].pageY-l,f=u,document.addEventListener("touchmove",y,!1),document.addEventListener("touchend",w,!1))}function y(e){e.preventDefault(),n.enabled&&gameBegin&&(s=e.touches[0].pageX-r,h=m+.08*(s-p),c=e.touches[0].pageY-l,u=f+.08*(c-d),h*Math.PI/180,o=u*Math.PI/180,a.rotation.x=o)}function w(){document.removeEventListener("touchmove",y,!1),document.removeEventListener("touchend",w,!1)}this.init=function(){n.cameraBox=new THREE.Object3D,n.cameraBox.add(a),a.position.y=2,a.position.z=0,i.add(n.cameraBox),document.addEventListener("touchstart",x,!1)},this.begin=function(e,t){n.cameraBox.position.x=0,n.cameraBox.position.y=300,n.cameraBox.position.z=0,o=(u=-90)*Math.PI/180,a.rotation.x=o,TweenMax.to(n.cameraBox.position,2,{x:e,y:0,z:t,ease:Cubic.easeInOut,delay:.5,onUpdate:function(){n.cameraBox.position.y<300&&(o=(u+=.8)*Math.PI/180,a.rotation.x=o)},onComplete:function(){o=(u=0)*Math.PI/180,TweenMax.to(a.rotation,.2,{x:o}),tipIn()}})},this.changeCamera=function(){0==g?(g=!0,TweenMax.to(a.position,.3,{y:50})):(g=!1,TweenMax.to(a.position,.3,{y:2}))},this.setTarget=function(e){h=45},this.setPosition=function(e){n.cameraBox.position.x=e.x,n.cameraBox.position.y=e.y,n.cameraBox.position.z=e.z},this.update=function(e){n.enabled},this.rotationY=function(e){n.cameraBox.rotation.y-=e*Math.PI/180}},wid,hei,clock,delta,stats;function Rocker(e){PIXI.Sprite.call(this,e);var t,i,o,r=this,l=!1,s=0,c=0,p=80,d=0,h=0;this.moveSpeedX=.02,this.moveSpeedZ=.001;var n;new THREE.Vector3;r.init=function(e){(t=new PIXI.Graphics).beginFill(16777215,.3),t.drawCircle(d,h,p),t.endFill(),(i=new PIXI.Graphics).beginFill(16777215,.3),i.drawCircle(d,h,40),i.endFill(),e&&(n=e),r.addChild(t),r.addChild(i),i.interactive=!0,i.on("touchstart",function(e){gameBegin&&(o=e.data,l=!0,controlState(!1))}),document.body.addEventListener("touchend",function(){gameBegin&&(l=!1,i.x=i.y=0,controlState(!(c=0)))}),i.on("touchmove",function(e){if(gameBegin&&l){var t=o.getLocalPosition(i.parent),n=Math.getDistance({x:t.x,y:t.y},{x:0,y:0});if(p<n){var a=Math.getAngle({x:d,y:h},{x:t.x,y:t.y});a-=90,t.x=Math.cos(a*Math.PI/180)*p,t.y=Math.sin(a*Math.PI/180)*p}i.x=t.x,i.y=t.y,s=(i.y-h)*r.moveSpeedZ,c=(i.x-d)*r.moveSpeedX}})},this.update=function(e){l&&n(c,s)}}Rocker.prototype=new PIXI.Sprite,Rocker.prototype.constructor=Rocker;var gameBegin=!1,pixi,threejs;function loadingComplete(){threejs.create_floor(),threejs.create_Maze(),threejs.initHitBall(),threejs.initAction(),pixi.createRocker(setCameraBox)}function getSize(){wid=window.innerWidth,hei=window.innerHeight,windowHalfX=wid/2}function controlState(e){threejs.controlState(e)}function initStats(){(stats=new Stats).domElement.style.position="absolute",stats.domElement.style.bottom="50px",stats.domElement.style.zIndex=100,document.getElementById("pixiStage").appendChild(stats.domElement)}function tipIn(){pixi.tipIn(),pixi.btnIn(threejs.changeCamera),pixi.keysIcon()}function setCameraBox(e,t){threejs.setCameraBox(e,t)}function render(){delta=clock.getDelta(),pixi&&pixi.update(delta),threejs&&threejs.update(delta),requestAnimationFrame(render)}function delKey(){threejs.delKey(),gameBegin=!0,pixi.keysChange()}$(function(){shareObj={sharePath:"http://h5n.180china.com/lab/mazeGame/index.html",shareImg:"http://h5n.180china.com/lab/mazeGame/images/icon.jpg",shareTitle:"欢乐走迷宫",shareDesc:"可好玩了"},setShare(),clock=new THREE.Clock,delta=clock.getDelta(),getSize(),(threejs=new ThreeArea).init(wid,hei),(pixi=new PixiArea).init(wid,hei),pixi.createLoading(loadingComplete),render()});